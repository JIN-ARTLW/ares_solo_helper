<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ares Expedition 1ì¸í”Œ ë„ìš°ë¯¸</title>
  <style>
    /* ===== Glassâ€‘morphism Mars Theme ===== */
    :root{
      --mars:#ff6f3c;                /* í™”ì„± í¬ì¸íŠ¸ */
      --spaceA:#0b0024;              /* ê¹Šì€ ìš°ì£¼ */
      --spaceB:#1d084d;              /* ë³´ë¼/ë‚¨ìƒ‰ */
      --glass-bg: rgba(255,255,255,.15); /* ì¹´ë“œ ë° ê¸°íƒ€ ìœ ë¦¬ íš¨ê³¼ ë°°ê²½ */
    }
    /* ----- global layout ----- */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body{
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      background:
        radial-gradient(ellipse at 50% 80%, var(--mars) 0%, transparent 55%),
        linear-gradient(135deg, var(--spaceA), var(--spaceB) 60%);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      color: #fff;
    }
    h1.title {
      font-size: 2.6rem;
      font-weight: 700;
      letter-spacing: -0.5px;
      margin-bottom: 1.2rem;
      text-align: center;
    }
    .info {
      text-align: center;
      font-size: 1.05rem;
      margin-bottom: 0.8rem;
      color: #d4d4ff;
    }
    /* tracker */
    .tracker {
      display: flex;
      gap: 0.6rem;
      margin-bottom: 1.4rem;
    }
    .tracker span {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: inline-block;
      background: var(--c);
      box-shadow: 0 0 4px var(--c);
      transition: transform 0.2s, filter 0.2s;
    }
    .tracker span.used {
      opacity: 0.35;
      filter: brightness(0.3);
      transform: scale(0.9);
    }
    /* ----- toggle switch ----- */
    .toggle-wrap{
      position: absolute;
      top: 18px;
      right: 22px;
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-size: 0.8rem;
    }
    .toggle-label {
      user-select: none;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 36px;
      height: 20px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #888;
      border-radius: 20px;
      transition: 0.3s;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 14px;
      width: 14px;
      left: 3px;
      bottom: 3px;
      background: white;
      border-radius: 50%;
      transition: 0.3s;
    }
    input:checked + .slider {
      background: #ffb066;
    }
    input:checked + .slider:before {
      transform: translateX(16px);
    }
    /* ----- ë„ì›€ë§ ë²„íŠ¼ (í°ìƒ‰ ì›, ? í‘œì‹œ) ----- */
    .help-button {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #fff;
      color: #000;
      border: none;
      font-size: 12px;
      cursor: pointer;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
    }
    /* ----- modal (ë„ì›€ë§) ìŠ¤íƒ€ì¼ ----- */
    .modal {
      display: none; 
      position: fixed; 
      z-index: 999; 
      padding-top: 100px; 
      left: 0;
      top: 0;
      width: 100%; 
      height: 100%; 
      overflow: auto; 
      background-color: rgba(0,0,0,0.5); 
    }
    .modal-content {
      /* ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ íš¨ê³¼ ì ìš© */
      background: var(--glass-bg);
      border: 1px solid rgba(255,255,255,0.25);
      backdrop-filter: blur(22px) saturate(180%);
      box-shadow: 0 8px 26px rgba(0,0,0,0.35);
      margin: auto;
      padding: 20px;
      width: 80%;
      max-width: 500px;
      border-radius: 10px;
      position: relative;
      color: #fff;
    }
    .close-button {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      position: absolute;
      top: 10px;
      right: 15px;
    }
    .close-button:hover,
    .close-button:focus {
      color: #fff;
      text-decoration: none;
      cursor: pointer;
    }
    /* ----- cards ----- */
    .card-grid{
      display: flex;
      gap: 1.2rem;
      margin-bottom: 2rem;
      flex-wrap: nowrap;
      justify-content: center;
    }
    .card {
      position: relative;
      flex: 1 1 180px;
      max-width: 220px;
      height: 300px;
      padding: 1rem;
      border-radius: 18px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      background: var(--glass-bg);
      border: 1px solid rgba(255,255,255,0.25);
      backdrop-filter: blur(22px) saturate(180%);
      box-shadow: 0 8px 26px rgba(0,0,0,0.35);
      transition: transform 0.25s;
    }
    .card:hover {
      transform: translateY(-6px);
    }
    .card.disabled {
      opacity: 0.3;
      pointer-events: none;
    }
    .card.selected {
      outline: 3px solid #ffb066;
      outline-offset: 2px;
    }
    .card header {
      text-align: center;
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.35rem;
      letter-spacing: -0.3px;
    }
    .sep {
      border: none;
      border-top: 1px solid rgba(255,255,255,0.28);
      margin: 0.35rem 0;
    }
    .card section {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 0.9rem;
      line-height: 1.25;
      color: #e9e9e9;
      padding: 0.4rem;
    }
    .card footer {
      font-size: 0.82rem;
      text-align: center;
      color: #ffdba5;
      margin-top: 0.4rem;
    }
    /* ----- phase dot inside card ----- */
    .phase-dot {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--c);
      box-shadow: 0 0 6px var(--c);
    }
    /* ----- buttons ----- */
    .button-area {
      text-align: center;
    }
    .button {
      background: #ffb066;
      color: #1a1a1a;
      padding: 0.55rem 1.3rem;
      border: none;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    .help-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    .help-table th,
    .help-table td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .help-table th {
      background-color: #1d084d;
    }
    /* ----- Developer Signature ----- */
    .signature {
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-size: 0.7rem;
      font-style: italic;
      font-family: "Times New Roman", serif;
      color: #fff;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <h3>Terraforming Mars</h3>
  <h1 class="title">Ares Expedition 1ì¸í”Œ ë„ìš°ë¯¸</h1>

  <!-- AIâ€‘only toggle ë° ë„ì›€ë§ ë²„íŠ¼ -->
  <div class="toggle-wrap" title="AIâ€‘only ëª¨ë“œ">
    <label class="switch">
      <input type="checkbox" id="ai-only-toggle">
      <span class="slider"></span>
    </label>
    <span class="toggle-label">AIâ€‘only</span>
    <button id="help-button" class="help-button" title="ë„ì›€ë§">?</button>
  </div>

  <div id="turn-info" class="info"></div>
  <div id="ai-tracker" class="tracker" title="AIê°€ ì´ë²ˆ TRì—ì„œ ì‚¬ìš©í•œ ë‹¨ê³„"></div>
  <div id="card-grid" class="card-grid"></div>
  <div id="show-grid" class="card-grid" style="display:none"></div>
  <div class="button-area">
    <button class="button" onclick="nextTurn()">ë‹¤ìŒ í„´ (Enter)</button>
  </div>

  <!-- ë„ì›€ë§ ëª¨ë‹¬ (ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ ì ìš©) -->
  <div id="help-modal" class="modal">
    <div class="modal-content">
      <span class="close-button" id="close-help">&times;</span>
      <section>
        <h3>AI-only ëª¨ë“œ</h3>
        <p>ë”ë¯¸ ë±ì˜ ë‹¨ê³„ ì¹´ë“œë§Œ ë½‘ìŠµë‹ˆë‹¤.</p>
      </section>
      <hr class="sep">
      <section>
        <h3>ì¼ë°˜ í–‰ë™</h3>
        <table class="help-table">
          <thead>
            <tr>
              <th>ì¡°ê±´</th>
              <th>íš¨ê³¼</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>ì‹ë¬¼ ìì› 8ê°œ</td>
              <td>ìˆ² ìŠ¹ì  í† í° 1ê°œ + ì‚°ì†Œ ë†ë„ 1%</td>
            </tr>
            <tr>
              <td>20MC</td>
              <td>ìˆ² ìŠ¹ì  í† í° 1ê°œ + ì‚°ì†Œ ë†ë„ 1%</td>
            </tr>
            <tr>
              <td>ì—´ ìì› 8ê°œ</td>
              <td>ê¸°ì˜¨ 1ë‹¨ê³„</td>
            </tr>
            <tr>
              <td>14MC</td>
              <td>ê¸°ì˜¨ 1ë‹¨ê³„</td>
            </tr>
            <tr>
              <td>15MC</td>
              <td>í•´ì–‘ íƒ€ì¼ 1ì¥ì„ ë’¤ì§‘ê³  í‘œì‹œëœ ë³´ìƒì„ ì¦‰ì‹œ íšë“</td>
            </tr>
          </tbody>
        </table>
      </section>
    </div>
  </div>

  <script>
    /* ===== game data ===== */
    const PHASES = [
      {n:'â… ', name:'ê°œë°œ ë‹¨ê³„', desc:'ì´ˆë¡ìƒ‰ ì¹´ë“œë¥¼ 1ì¥ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', bonus:'ì´ ë‹¨ê³„ì— ë‚´ê°€ ì‚¬ìš©í•˜ëŠ” ì¹´ë“œëŠ” ì¶”ì§„ ë¹„ìš© 3MC í• ì¸.'},
      {n:'â…¡', name:'ê±´ì„¤ ë‹¨ê³„', desc:'íŒŒë€ìƒ‰ ë˜ëŠ” ë¹¨ê°„ìƒ‰ ì¹´ë“œë¥¼ 1ì¥ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', bonus:'ì¹´ë“œ 1ì¥ íšë“ ë˜ëŠ”<br>íŒŒë€ìƒ‰/ë¹¨ê°„ìƒ‰ ì¹´ë“œ 1ì¥ ì¶”ê°€ ì‚¬ìš©.'},
      {n:'â…¢', name:'í™œë™ ë‹¨ê³„', desc:'ì›í•˜ëŠ” "í–‰ë™:" ëŠ¥ë ¥ ë° ì¼ë°˜ í–‰ë™ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', bonus:'"í–‰ë™:" ëŠ¥ë ¥ í•˜ë‚˜ë¥¼ í•œ ë²ˆ ë” ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'},
      {n:'â…£', name:'ìƒì‚° ë‹¨ê³„', desc:'ìƒì‚°ë ¥ë§Œí¼ ì—´Â·ì‹ë¬¼ ìì›, í”„ë¡œì íŠ¸ ì¹´ë“œë¥¼ íšë“í•©ë‹ˆë‹¤.<br>ê·¸ë¦¬ê³  ìì‹ ì˜ ìƒì‚°ë ¥+TRë§Œí¼ MCë¥¼ íšë“í•©ë‹ˆë‹¤.', bonus:'4 MC íšë“.<br>â€'},
      {n:'â…¤', name:'ì—°êµ¬ ë‹¨ê³„', desc:'ì¹´ë“œ 2ì¥ì„ ë½‘ê³  ê·¸ì¤‘ 1ì¥ì„ íšë“í•©ë‹ˆë‹¤.', bonus:'ì¶”ê°€ë¡œ 3ì¥ì„ ë” ë½‘ê³  1ì¥ì„ ë” íšë“í•©ë‹ˆë‹¤.'}
    ];

    /* ===== colors for phase dots & tracker ===== */
    const DOTS = [
      '#4caf50',
      'linear-gradient(45deg,#d32f2f 0%,#1565c0 100%)',
      '#4fc3f7',
      '#ff7043',
      '#ffd54f'
    ];

    /* ===== state ===== */
    let currentTurn = 1, lastUserPhase = null, userPhase = null, aiPhase = null, isSelectingAI = false;
    let aiDeck = [], aiUsedThisTR = [];
    let aiOnly = false; // í† ê¸€ ìƒíƒœ

    /* ===== dom ===== */
    const aiTracker = document.getElementById('ai-tracker');
    const cardGrid = document.getElementById('card-grid');
    const showGrid = document.getElementById('show-grid');
    const turnInfo = document.getElementById('turn-info');
    const aiOnlyToggle = document.getElementById('ai-only-toggle');

    /* ===== helpers ===== */
    function shuffleDeck() {
      aiDeck = [...PHASES].sort(() => Math.random() - 0.5);
    }
    function updateTracker(){
      aiTracker.innerHTML = '';
      PHASES.forEach((p, i) => {
        const span = document.createElement('span');
        span.style.setProperty('--c', DOTS[i]);
        span.title = p.n + " " + p.name;
        if(aiUsedThisTR.includes(p.name)) span.classList.add('used');
        aiTracker.appendChild(span);
      });
    }
    function cardHTML(p) {
      return `<header>${p.n ? p.n + ' ' : ''}${p.name}</header>
              <hr class='sep'/>
              <section>${p.desc}</section>
              <hr class='sep'/>
              <footer><b>ë³´ë„ˆìŠ¤:</b> ${p.bonus}</footer>`;
    }
    function placeholderPhase(){
      return {n:'', name:'í”Œë ˆì´ì–´ ì„ íƒ', desc:'AIâ€‘only ëª¨ë“œì—ì„œ<br>í”Œë ˆì´ì–´ ì¹´ë“œëŠ” ì—†ìŠµë‹ˆë‹¤.', bonus:'-<br>â€'};
    }

    /* ===== rendering ===== */
    function drawCards(){
      const aiTR = Math.ceil(currentTurn/5);
      cardGrid.innerHTML = '';
      PHASES.forEach((p, i) => {
        const d = document.createElement('div');
        d.className = 'card';
        d.innerHTML = cardHTML(p);
        const dot = document.createElement('span');
        dot.className = 'phase-dot';
        dot.style.setProperty('--c', DOTS[i]);
        d.appendChild(dot);

        // ----- disable logic -----
        const disableUser = aiOnly && aiTR !== 5; // AIâ€‘only ëª¨ë“œ ì¤‘ ë§ˆì§€ë§‰ TRì´ ì•„ë‹ˆë©´ í´ë¦­ ê¸ˆì§€
        if(disableUser) d.classList.add('disabled');

        // ì¼ë°˜ ëª¨ë“œ ì¤‘ ì´ë¯¸ ì„ íƒëœ/ì‚¬ìš©ëœ ì¹´ë“œ
        if(!aiOnly){
          if(p.name === lastUserPhase && !isSelectingAI) d.classList.add('disabled');
          if(isSelectingAI && aiUsedThisTR.includes(p.name)) d.classList.add('disabled');
          if(isSelectingAI && userPhase && p.name === userPhase.name) d.classList.add('selected');
        }

        // AIâ€‘only ëª¨ë“œ(ë§ˆì§€ë§‰ TR): ì´ë¯¸ ì‚¬ìš©í•œ ì¹´ë“œëŠ” ëˆ„ì  ë¹„í™œì„±í™”
        if(aiOnly && aiTR === 5 && aiUsedThisTR.includes(p.name)) d.classList.add('disabled');

        if(!d.classList.contains('disabled')) d.onclick = () => selectCard(p);
        cardGrid.appendChild(d);
      });
    }

    /* ===== game logic ===== */
    function selectCard(p){
      const aiTR = Math.ceil(currentTurn/5);

      // --- AIâ€‘only ëª¨ë“œ ---
      if(aiOnly){
        if(aiTR !== 5) return; // ë§ˆì§€ë§‰ TR(5) ì™¸ì—ëŠ” ì„ íƒ ë¶ˆê°€
        if(aiUsedThisTR.includes(p.name)) return; // ì´ë¯¸ ì‚¬ìš©í•œ ì¹´ë“œ ì¬ì„ íƒ ë°©ì§€
        aiPhase = p;
        aiUsedThisTR.push(p.name);
        userPhase = placeholderPhase(); // ì‚¬ìš©ì ì¹´ë“œëŠ” ë”ë¯¸ë¡œ ì±„ì›Œì¤Œ
        showSelected();
        return;
      }

      // --- ì¼ë°˜ ëª¨ë“œ ---
      if(aiTR === 5){
        if(!userPhase){ 
          userPhase = p;
          lastUserPhase = p.name;
          isSelectingAI = true;
          drawCards();
          return;
        }
        if(isSelectingAI){
          if(aiUsedThisTR.includes(p.name)) return;
          aiPhase = p;
          aiUsedThisTR.push(p.name);
          showSelected();
          return;
        }
      }
      if(userPhase) return;
      userPhase = p;
      lastUserPhase = p.name;
      if(aiDeck.length === 0){
        shuffleDeck();
        aiUsedThisTR = [];
        updateTracker();
      }
      aiPhase = aiDeck.pop();
      aiUsedThisTR.push(aiPhase.name);
      showSelected();
    }

    function autoSelectForAIOnly(){
      if(aiDeck.length === 0){
        shuffleDeck();
        aiUsedThisTR = [];
        updateTracker();
      }
      userPhase = placeholderPhase();
      aiPhase = aiDeck.pop();
      aiUsedThisTR.push(aiPhase.name);
      showSelected();
    }

    function showSelected(){
      updateTracker();
      cardGrid.style.display = 'none';
      showGrid.style.display = 'flex';
      showGrid.innerHTML = '';
      [userPhase, aiPhase].forEach(p => {
        const idx = PHASES.findIndex(x => x.name === p.name);
        const d = document.createElement('div');
        d.className = 'card selected';
        d.innerHTML = cardHTML(p);
        const dot = document.createElement('span');
        dot.className = 'phase-dot';
        if(idx > -1) dot.style.setProperty('--c', DOTS[idx]);
        d.appendChild(dot);
        showGrid.appendChild(d);
      });
    }

    function nextTurn(){
      // AIâ€‘only ëª¨ë“œì—ì„œ ì•„ì§ ì¹´ë“œê°€ ì„ íƒë˜ì§€ ì•Šì•˜ë‹¤ë©´ ìë™ ì„ íƒ ìˆ˜í–‰
      if(aiOnly && !aiPhase){
        autoSelectForAIOnly();
        return;
      }
      if(!userPhase || !aiPhase) return;
      currentTurn++;
      // ìƒˆ TR ì‹œì‘ ì‹œ ì´ˆê¸°í™”
      if((currentTurn-1) % 5 === 0){
        aiUsedThisTR = [];
        lastUserPhase = null;
        shuffleDeck();
        updateTracker();
      }
      userPhase = aiPhase = null;
      isSelectingAI = false;
      turnInfo.textContent = `ë‹¨ê³„ : ${(currentTurn-1)%5+1} / 5  ğŸª  AI TR : ${Math.ceil(currentTurn/5)} / 5`;
      showGrid.style.display = 'none';
      cardGrid.style.display = 'flex';
      drawCards();
      if(Math.ceil(currentTurn/5) > 5){
        alert('ê²Œì„ ì¢…ë£Œ');
        location.reload();
      }
    }

    /* ===== init ===== */
    shuffleDeck();
    updateTracker();
    turnInfo.textContent = 'ë‹¨ê³„ : 1 / 5  ğŸª  AI TR : 1 / 5';
    drawCards();

    document.addEventListener('keydown', e => {
      if(e.key === 'Enter') nextTurn();
      if('12345'.includes(e.key)){
        const idx = parseInt(e.key) - 1;
        const card = cardGrid.children[idx];
        if(card && !card.classList.contains('disabled')) card.click();
      }
    });

    aIOnlyToggleHandler();
    function aIOnlyToggleHandler(){
      aiOnlyToggle.addEventListener('change', () => {
        aiOnly = aiOnlyToggle.checked;
        // ëª¨ë“œ ì „í™˜ ì‹œ í˜„ì¬ ì„ íƒ ë‹¨ê³„ ì´ˆê¸°í™” (ì•ˆì „)
        if(aiOnly){
          userPhase = aiPhase = null;
          isSelectingAI = false;
          aiUsedThisTR = [];
          updateTracker();
        }
        drawCards();
      });
    }

    /* ----- ë„ì›€ë§ ëª¨ë‹¬ ê´€ë ¨ ----- */
    const helpButton = document.getElementById('help-button');
    const helpModal = document.getElementById('help-modal');
    const closeHelp = document.getElementById('close-help');

    helpButton.addEventListener('click', () => {
      helpModal.style.display = 'block';
    });

    closeHelp.addEventListener('click', () => {
      helpModal.style.display = 'none';
    });

    window.addEventListener('click', (event) => {
      if(event.target === helpModal){
        helpModal.style.display = 'none';
      }
    });
  </script>
  <!-- Developer Signature -->
  <div class="signature">Life On Mars!</div>
</body>
</html>
